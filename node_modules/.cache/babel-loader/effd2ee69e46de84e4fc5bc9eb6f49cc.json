{"ast":null,"code":"'use strict';\n/*!\n * ignore\n */\n\nmodule.exports = applyQueryMiddleware;\n\nconst validOps = require('./validOps');\n/*!\n * ignore\n */\n\n\napplyQueryMiddleware.middlewareFunctions = validOps.concat(['validate']);\n/*!\n * Apply query middleware\n *\n * @param {Query} query constructor\n * @param {Model} model\n */\n\nfunction applyQueryMiddleware(Query, model) {\n  const kareemOptions = {\n    useErrorHandlers: true,\n    numCallbackParams: 1,\n    nullResultByDefault: true\n  };\n  const middleware = model.hooks.filter(hook => {\n    const contexts = _getContexts(hook);\n\n    if (hook.name === 'updateOne') {\n      return contexts.query == null || !!contexts.query;\n    }\n\n    if (hook.name === 'deleteOne') {\n      return !!contexts.query || Object.keys(contexts).length === 0;\n    }\n\n    if (hook.name === 'validate' || hook.name === 'remove') {\n      return !!contexts.query;\n    }\n\n    if (hook.query != null || hook.document != null) {\n      return !!hook.query;\n    }\n\n    return true;\n  }); // `update()` thunk has a different name because `_update` was already taken\n\n  Query.prototype._execUpdate = middleware.createWrapper('update', Query.prototype._execUpdate, null, kareemOptions); // `distinct()` thunk has a different name because `_distinct` was already taken\n\n  Query.prototype.__distinct = middleware.createWrapper('distinct', Query.prototype.__distinct, null, kareemOptions); // `validate()` doesn't have a thunk because it doesn't execute a query.\n\n  Query.prototype.validate = middleware.createWrapper('validate', Query.prototype.validate, null, kareemOptions);\n  applyQueryMiddleware.middlewareFunctions.filter(v => v !== 'update' && v !== 'distinct' && v !== 'validate').forEach(fn => {\n    Query.prototype[`_${fn}`] = middleware.createWrapper(fn, Query.prototype[`_${fn}`], null, kareemOptions);\n  });\n}\n\nfunction _getContexts(hook) {\n  const ret = {};\n\n  if (hook.hasOwnProperty('query')) {\n    ret.query = hook.query;\n  }\n\n  if (hook.hasOwnProperty('document')) {\n    ret.document = hook.document;\n  }\n\n  return ret;\n}","map":{"version":3,"names":["module","exports","applyQueryMiddleware","validOps","require","middlewareFunctions","concat","Query","model","kareemOptions","useErrorHandlers","numCallbackParams","nullResultByDefault","middleware","hooks","filter","hook","contexts","_getContexts","name","query","Object","keys","length","document","prototype","_execUpdate","createWrapper","__distinct","validate","v","forEach","fn","ret","hasOwnProperty"],"sources":["B:/web_project_react/web_car_react/node_modules/mongoose/lib/helpers/query/applyQueryMiddleware.js"],"sourcesContent":["'use strict';\n\n/*!\n * ignore\n */\n\nmodule.exports = applyQueryMiddleware;\n\nconst validOps = require('./validOps');\n\n/*!\n * ignore\n */\n\napplyQueryMiddleware.middlewareFunctions = validOps.concat([\n  'validate'\n]);\n\n/*!\n * Apply query middleware\n *\n * @param {Query} query constructor\n * @param {Model} model\n */\n\nfunction applyQueryMiddleware(Query, model) {\n  const kareemOptions = {\n    useErrorHandlers: true,\n    numCallbackParams: 1,\n    nullResultByDefault: true\n  };\n\n  const middleware = model.hooks.filter(hook => {\n    const contexts = _getContexts(hook);\n    if (hook.name === 'updateOne') {\n      return contexts.query == null || !!contexts.query;\n    }\n    if (hook.name === 'deleteOne') {\n      return !!contexts.query || Object.keys(contexts).length === 0;\n    }\n    if (hook.name === 'validate' || hook.name === 'remove') {\n      return !!contexts.query;\n    }\n    if (hook.query != null || hook.document != null) {\n      return !!hook.query;\n    }\n    return true;\n  });\n\n  // `update()` thunk has a different name because `_update` was already taken\n  Query.prototype._execUpdate = middleware.createWrapper('update',\n    Query.prototype._execUpdate, null, kareemOptions);\n  // `distinct()` thunk has a different name because `_distinct` was already taken\n  Query.prototype.__distinct = middleware.createWrapper('distinct',\n    Query.prototype.__distinct, null, kareemOptions);\n\n  // `validate()` doesn't have a thunk because it doesn't execute a query.\n  Query.prototype.validate = middleware.createWrapper('validate',\n    Query.prototype.validate, null, kareemOptions);\n\n  applyQueryMiddleware.middlewareFunctions.\n    filter(v => v !== 'update' && v !== 'distinct' && v !== 'validate').\n    forEach(fn => {\n      Query.prototype[`_${fn}`] = middleware.createWrapper(fn,\n        Query.prototype[`_${fn}`], null, kareemOptions);\n    });\n}\n\nfunction _getContexts(hook) {\n  const ret = {};\n  if (hook.hasOwnProperty('query')) {\n    ret.query = hook.query;\n  }\n  if (hook.hasOwnProperty('document')) {\n    ret.document = hook.document;\n  }\n  return ret;\n}"],"mappings":"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"},"metadata":{},"sourceType":"script"}